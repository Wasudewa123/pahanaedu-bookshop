<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple Database Connection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .book-form { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Test Simple Database Connection</h1>
    
    <div class="test-section">
        <h2>1. Test Basic API Connection</h2>
        <button onclick="testBasicConnection()">Test Basic Connection</button>
        <div id="basic-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test Books API</h2>
        <button onclick="testBooksAPI()">Test Books API</button>
        <div id="books-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Test Book Statistics</h2>
        <button onclick="testBookStats()">Test Book Statistics</button>
        <div id="stats-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Add Test Book</h2>
        <div class="book-form">
            <div class="form-group">
                <label>Title:</label>
                <input type="text" id="book-title" value="Test Book">
            </div>
            <div class="form-group">
                <label>Author:</label>
                <input type="text" id="book-author" value="Test Author">
            </div>
            <div class="form-group">
                <label>Category:</label>
                <select id="book-category">
                    <option value="Novels">Novels</option>
                    <option value="Children">Children</option>
                    <option value="Featured">Featured</option>
                    <option value="New Arrivals">New Arrivals</option>
                </select>
            </div>
            <div class="form-group">
                <label>Price:</label>
                <input type="number" id="book-price" value="19.99" step="0.01">
            </div>
            <div class="form-group">
                <label>Stock Quantity:</label>
                <input type="number" id="book-stock" value="10">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea id="book-description" rows="3">This is a test book for database verification.</textarea>
            </div>
            <button onclick="addTestBook()">Add Test Book</button>
        </div>
        <div id="add-book-result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Database Status</h2>
        <button onclick="checkDatabaseStatus()">Check Database Status</button>
        <div id="db-status-result"></div>
    </div>

    <script>
        async function testBasicConnection() {
            const resultDiv = document.getElementById('basic-result');
            resultDiv.innerHTML = '<p class="info">Testing basic connection...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/books/all', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = '<p class="success">‚úÖ Basic connection successful! Server is running.</p>';
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå Server responded with status: ${response.status}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Connection failed: ${error.message}</p>`;
            }
        }
        
        async function testBooksAPI() {
            const resultDiv = document.getElementById('books-result');
            resultDiv.innerHTML = '<p class="info">Testing books API...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/books/all', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ Books API working!</p>
                    <p>Total books: ${data.books ? data.books.length : 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function testBookStats() {
            const resultDiv = document.getElementById('stats-result');
            resultDiv.innerHTML = '<p class="info">Testing book statistics...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/books/stats', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ Book Statistics API working!</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function addTestBook() {
            const resultDiv = document.getElementById('add-book-result');
            resultDiv.innerHTML = '<p class="info">Adding test book...</p>';
            
            const bookData = {
                title: document.getElementById('book-title').value,
                author: document.getElementById('book-author').value,
                category: document.getElementById('book-category').value,
                price: parseFloat(document.getElementById('book-price').value),
                stockQuantity: parseInt(document.getElementById('book-stock').value),
                description: document.getElementById('book-description').value,
                isbn: "TEST-ISBN-" + Date.now(),
                language: "English",
                publishedYear: 2024,
                format: "Paperback",
                rating: 4.0,
                ratingCount: 0,
                publisher: "Test Publisher",
                pages: 200,
                imageUrl: "https://example.com/test-book.jpg"
            };
            
            try {
                const response = await fetch('http://localhost:8080/api/books', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookData)
                });
                
                const data = await response.json();
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ Test book added successfully!</p>
                        <p>Book ID: ${data.book.id}</p>
                        <pre>${JSON.stringify(data.book, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå Error adding book: ${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function checkDatabaseStatus() {
            const resultDiv = document.getElementById('db-status-result');
            resultDiv.innerHTML = '<p class="info">Checking database status...</p>';
            
            try {
                // Test multiple endpoints to check database status
                const [booksResponse, statsResponse] = await Promise.all([
                    fetch('http://localhost:8080/api/books/all'),
                    fetch('http://localhost:8080/api/books/stats')
                ]);
                
                const booksData = await booksResponse.json();
                const statsData = await statsResponse.json();
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ Database connection successful!</p>
                    <p><strong>Books in database:</strong> ${booksData.books ? booksData.books.length : 0}</p>
                    <p><strong>Database statistics:</strong></p>
                    <pre>${JSON.stringify(statsData.stats, null, 2)}</pre>
                    <p class="info">üí° If you see books and statistics, the database is working correctly!</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå Database connection failed: ${error.message}</p>
                    <p class="info">üí° Make sure MongoDB is running and the database is created.</p>
                `;
            }
        }
    </script>
</body>
</html> 