<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pahana Admin - Simple Dashboard</title>
    <link rel="stylesheet" href="admin-dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-book"></i>
                <span>Pahana Admin</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" onclick="showSection('customers')">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </li>
                <li class="nav-item" onclick="showSection('orders')">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </li>
                <li class="nav-item" onclick="showSection('books')">
                    <i class="fas fa-book"></i>
                    <span>Books</span>
                </li>
                <li class="nav-item" onclick="showSection('billing')">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Billing</span>
                </li>
                <li class="nav-item" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </li>
            </ul>
            <div class="admin-info">
                <div class="admin-name">System Administrator</div>
                <div class="admin-role">SUPER_ADMIN</div>
                <div class="logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h2><i class="fas fa-star"></i> Dashboard Overview</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon customers">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-customers">0</h3>
                            <p>Total Customers</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon orders">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-orders">0</h3>
                            <p>Total Orders</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon books">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-books">0</h3>
                            <p>Total Books</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-revenue">Rs. 0</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="recent-orders">
                        <div class="section-header">
                            <h3><i class="fas fa-clock"></i> Recent Orders</h3>
                            <button class="view-all-btn">View All</button>
                        </div>
                        <div id="recent-orders-list" class="orders-list">
                            <p>No recent orders</p>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="section-header">
                            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                        </div>
                        <div class="action-buttons">
                            <button onclick="showAddCustomerModal()">
                                <i class="fas fa-user-plus"></i>
                                Add Customer
                            </button>
                            <button onclick="showAddBookModal()">
                                <i class="fas fa-plus"></i>
                                Add Book
                            </button>
                            <button onclick="showSection('billing')">
                                <i class="fas fa-file-invoice"></i>
                                Generate Bill
                            </button>
                            <button>
                                <i class="fas fa-download"></i>
                                Export Report
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Customers Section -->
            <section id="customers-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Customer Management</h2>
                    <button onclick="showAddCustomerModal()" class="add-btn">
                        <i class="fas fa-plus"></i> Add Customer
                    </button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="customer-search" placeholder="Search customers...">
                    <button onclick="searchCustomers()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Account Number</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Joined Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table-body">
                            <tr>
                                <td colspan="6">Loading customers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Billing Section -->
            <section id="billing-section" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Billing System</h2>
                </div>
                
                <div class="billing-container">
                    <div class="billing-form">
                        <h3>Generate Bill</h3>
                        <form id="billing-form">
                            <div class="form-group">
                                <label for="customer-account">Customer Account Number:</label>
                                <input type="text" id="customer-account" placeholder="Enter account number" required>
                            </div>
                            <div class="form-group">
                                <label for="units-consumed">Units Consumed:</label>
                                <input type="number" id="units-consumed" placeholder="Enter units" required>
                            </div>
                            <div class="form-group">
                                <label for="rate-per-unit">Rate per Unit:</label>
                                <input type="number" id="rate-per-unit" placeholder="Enter rate" step="0.01" required>
                            </div>
                            <button type="submit" class="generate-bill-btn">
                                <i class="fas fa-calculator"></i> Calculate Bill
                            </button>
                        </form>
                    </div>
                    
                    <div id="bill-preview" class="bill-preview">
                        <!-- Bill preview will be displayed here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Simple dashboard without authentication
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadCustomers();
        });

        async function loadDashboardData() {
            try {
                // Load customers
                const customersResponse = await fetch('http://localhost:8080/api/admin/customers');
                const customers = customersResponse.ok ? await customersResponse.json() : [];
                
                // Load books
                const booksResponse = await fetch('http://localhost:8080/api/books');
                const books = booksResponse.ok ? await booksResponse.json() : [];
                
                // Load orders
                const ordersResponse = await fetch('http://localhost:8080/api/admin/orders');
                const orders = ordersResponse.ok ? await ordersResponse.json() : [];
                
                // Update dashboard stats
                document.getElementById('total-customers').textContent = customers.length;
                document.getElementById('total-books').textContent = books.length;
                document.getElementById('total-orders').textContent = orders.length;
                
                const totalRevenue = orders.reduce((sum, order) => sum + (order.totalPrice || 0), 0);
                document.getElementById('total-revenue').textContent = `Rs. ${totalRevenue.toFixed(2)}`;
                
                // Load recent orders
                loadRecentOrders(orders.slice(0, 5));
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadCustomers() {
            try {
                const response = await fetch('http://localhost:8080/api/admin/customers');
                if (response.ok) {
                    const customers = await response.json();
                    displayCustomers(customers);
                }
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        function displayCustomers(customers) {
            const tbody = document.getElementById('customers-table-body');
            tbody.innerHTML = '';
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No customers found</td></tr>';
                return;
            }
            
            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.accountNumber || customer.id || 'N/A'}</td>
                    <td>${customer.name || customer.username}</td>
                    <td>${customer.email || 'N/A'}</td>
                    <td>${customer.phone || 'N/A'}</td>
                    <td>${customer.createdAt ? new Date(customer.createdAt).toLocaleDateString() : 'N/A'}</td>
                    <td>
                        <button class="edit-btn" onclick="editCustomer('${customer.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" onclick="deleteCustomer('${customer.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadRecentOrders(orders) {
            const ordersList = document.getElementById('recent-orders-list');
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p>No recent orders</p>';
                return;
            }
            
            orders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <div class="order-info">
                        <h4>${order.customerName || 'Guest'}</h4>
                        <p>${order.bookTitle} - Qty: ${order.quantity}</p>
                    </div>
                    <div class="order-status ${order.status ? order.status.toLowerCase() : 'pending'}">
                        ${order.status || 'PENDING'}
                    </div>
                `;
                ordersList.appendChild(orderItem);
            });
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).classList.add('active');
            
            // Add active class to clicked nav item
            event.target.closest('.nav-item').classList.add('active');
        }

        // Billing form submission
        document.getElementById('billing-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const accountNumber = document.getElementById('customer-account').value;
            const unitsConsumed = parseInt(document.getElementById('units-consumed').value);
            const ratePerUnit = parseFloat(document.getElementById('rate-per-unit').value);
            
            if (!accountNumber || !unitsConsumed || !ratePerUnit) {
                alert('Please fill in all fields');
                return;
            }
            
            try {
                // First, get customer details
                const customerResponse = await fetch(`http://localhost:8080/api/billing/customer/${accountNumber}`);
                const customerData = await customerResponse.json();
                
                if (!customerResponse.ok) {
                    alert('Customer not found with account number: ' + accountNumber);
                    return;
                }
                
                // Generate bill
                const billResponse = await fetch('http://localhost:8080/api/billing/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accountNumber: accountNumber,
                        unitsConsumed: unitsConsumed,
                        ratePerUnit: ratePerUnit
                    })
                });
                
                const billData = await billResponse.json();
                
                if (billResponse.ok) {
                    const bill = billData.bill;
                    displayBillPreview(bill, customerData.customer);
                } else {
                    alert('Error generating bill: ' + billData.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error generating bill');
            }
        });

        function displayBillPreview(bill, customer) {
            const billPreview = document.getElementById('bill-preview');
            billPreview.innerHTML = `
                <h3>Bill Generated Successfully!</h3>
                <div class="bill-details">
                    <p><strong>Bill Number:</strong> ${bill.billNumber}</p>
                    <p><strong>Customer Name:</strong> ${customer.name}</p>
                    <p><strong>Account Number:</strong> ${bill.accountNumber}</p>
                    <p><strong>Units Consumed:</strong> ${bill.unitsConsumed}</p>
                    <p><strong>Rate per Unit:</strong> Rs. ${bill.ratePerUnit}</p>
                    <p><strong>Total Amount:</strong> Rs. ${bill.totalAmount.toFixed(2)}</p>
                    <p><strong>Bill Date:</strong> ${new Date(bill.billDate).toLocaleDateString()}</p>
                    <p><strong>Status:</strong> <span class="status-${bill.status.toLowerCase()}">${bill.status}</span></p>
                </div>
                <div class="bill-actions">
                    <button class="generate-bill-btn" onclick="printBill('${bill.billNumber}')">
                        <i class="fas fa-print"></i> Print Bill
                    </button>
                    <button class="generate-bill-btn" onclick="saveBill('${bill.id}')">
                        <i class="fas fa-save"></i> Save Bill
                    </button>
                </div>
            `;
        }

        function logout() {
            window.location.href = 'admin-login.html';
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            const rows = document.querySelectorAll('#customers-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function editCustomer(customerId) {
            alert('Edit customer functionality to be implemented');
        }

        function deleteCustomer(customerId) {
            if (!confirm('Are you sure you want to delete this customer?')) return;
            alert('Delete customer functionality to be implemented');
        }

        function showAddCustomerModal() {
            alert('Add customer modal to be implemented');
        }

        function showAddBookModal() {
            alert('Add book modal to be implemented');
        }

        function printBill() {
            alert('Print bill functionality to be implemented');
        }

        function saveBill() {
            alert('Save bill functionality to be implemented');
        }
    </script>
</body>
</html> 