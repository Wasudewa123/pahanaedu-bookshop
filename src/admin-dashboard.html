<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Pahana Book Shop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin-dashboard.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <!-- Fallback CDN for jsPDF -->
    <script>
        // Fallback for jsPDF after page load to avoid blocking
        window.addEventListener('load', function() {
            if (typeof window.jspdf === 'undefined') {
                console.log('Loading jsPDF from fallback CDN...');
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js';
                script.defer = true;
                script.onload = function() { console.log('jsPDF loaded from fallback CDN'); };
                script.onerror = function() { console.error('Failed to load jsPDF from fallback CDN'); };
                document.head.appendChild(script);
            }
        });
    </script>
    <script>
        // Ensure jsPDF is available globally
        window.addEventListener('load', function() {
            if (window.jspdf && window.jspdf.jsPDF) {
                console.log('jsPDF loaded successfully via window.jspdf.jsPDF');
            } else if (window.jspdf && window.jspdf.default) {
                console.log('jsPDF loaded successfully via window.jspdf.default');
            } else if (window.jsPDF) {
                console.log('jsPDF loaded successfully via window.jsPDF');
            } else {
                console.error('jsPDF not found in any expected location');
            }
        });
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Fallback CDN for Chart.js after load to avoid main thread jank
        window.addEventListener('load', function() {
            if (typeof window.Chart === 'undefined') {
                console.log('Loading Chart.js from fallback CDN...');
                const s = document.createElement('script');
                s.src = 'https://unpkg.com/chart.js@4.4.3/dist/chart.umd.js';
                s.defer = true;
                s.onload = function () { console.log('Chart.js loaded from fallback CDN'); };
                s.onerror = function () { console.error('Failed to load Chart.js from fallback CDN'); };
                document.head.appendChild(s);
            }
        });
    </script>
    <link rel="stylesheet" href="admin-dashboard-enhanced-reports.css">
</head>
<body>
    <script>
        (function () {
            // Quick guard: require admin login before viewing dashboard
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.replace('admin-login.html?redirect=admin-dashboard.html');
                return;
            }
            // Optional: validate token against backend to avoid stale/invalid tokens
            try {
                fetch('http://localhost:8080/api/admin/profile', {
                    headers: { Authorization: `Bearer ${token}` },
                }).then(function (res) {
                    if (!res || !res.ok) {
                        localStorage.removeItem('adminToken');
                        window.location.replace('admin-login.html?redirect=admin-dashboard.html');
                    }
                }).catch(function () {
                    // On network error, still route to login to force re-auth
                    localStorage.removeItem('adminToken');
                    window.location.replace('admin-login.html?redirect=admin-dashboard.html');
                });
            } catch (_) {
                localStorage.removeItem('adminToken');
                window.location.replace('admin-login.html?redirect=admin-dashboard.html');
            }
        })();
    </script>
    <!-- Navigation -->
    <nav class="admin-nav">
        <div class="nav-brand">
            <i class="fas fa-book-open"></i>
            <span>Pahana Admin</span>
        </div>
        <div class="nav-menu">
          
            <button class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-item" data-section="customers" onclick="showSection('customers')">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </button>
            <button class="nav-item" data-section="orders" onclick="showSection('orders')">
                <i class="fas fa-shopping-cart"></i>
                <span>Orders</span>
            </button>
            <button class="nav-item" data-section="books" onclick="showSection('books')">
                <i class="fas fa-book"></i>
                <span>Books</span>
            </button>
            <button class="nav-item" data-section="billing" onclick="showSection('billing')">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Billing</span>
            </button>
            <button class="nav-item" data-section="reports" onclick="showSection('reports')">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </button>
            <button class="nav-item home" onclick="window.location.href='landingpage.html'">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
        </div>
        <div class="nav-user">
            <div class="user-info">
                <span id="admin-name">Admin</span>
            </div>
            <button class="logout-btn admin-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>ADMIN LOGOUT</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section active">
            <div class="section-header">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h1>
                <p>Welcome to Pahana Book Shop Administration</p>
                <button class="refresh-btn" onclick="refreshAllData()" title="Refresh all data">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon customers">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-customers">0</h3>
                        <p>Total Customers</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orders">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-orders">0</h3>
                        <p>Total Orders</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon books">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-books">0</h3>
                        <p>Total Books</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon revenue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-revenue">Rs. 0</h3>
                        <p>Total Revenue</p>
                    </div>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Recent Orders</h3>
                        <button class="view-all-btn" onclick="showSection('orders')">View All</button>
                    </div>
                    <div class="card-content">
                        <div id="recent-orders-list" class="orders-list">
                            <!-- Recent orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Quick Actions</h3>
                    </div>
                    <div class="card-content">
                        <div class="quick-actions">
                            <button class="action-btn add-customer" onclick="showSection('customers')">
                                <i class="fas fa-user-plus"></i>
                                <span>Add Customer</span>
                            </button>
                            <button class="action-btn add-book" onclick="showSection('books')">
                                <i class="fas fa-plus"></i>
                                <span>Add Book</span>
                            </button>
                            <button class="action-btn generate-bill" onclick="showSection('billing')">
                                <i class="fas fa-file-invoice"></i>
                                <span>Generate Bill</span>
                            </button>
                            <button class="action-btn export-report" onclick="showSection('reports')">
                                <i class="fas fa-download"></i>
                                <span>Export Report</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customers Section -->
        <section id="customers-section" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-users"></i> Customer Management</h1>
                <button class="add-btn" onclick="showAddCustomerModal()">
                    <i class="fas fa-plus"></i> Add Customer
                </button>
            </div>

            <div class="search-bar">
                <input type="text" id="customer-search" placeholder="Search customers...">
                <button onclick="searchCustomers()">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Account #</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Registration Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customers-table-body">
                        <!-- Customers will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="orders-section" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-shopping-cart"></i> Order Management</h1>
            </div>

                <div class="filters">
                <select id="orders-status-filter" onchange="filterOrders()">
                    <option value="">All Status</option>
                    <option value="PENDING">Pending</option>
                    <option value="COMPLETED">Completed</option>
                    <option value="CANCELLED">Cancelled</option>
                </select>
                <input type="date" id="date-filter" onchange="filterOrders()">
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Book</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table-body">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Books Section -->
        <section id="books-section" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-book"></i> Book Management</h1>
                <div style="display: flex; gap: 1rem;">
                    <button class="add-btn" onclick="showAddBookModal()">
                        <i class="fas fa-plus"></i> Add Book
                    </button>
                    <button class="add-btn" onclick="loadDemoBooks()" style="background: #f59e0b;">
                        <i class="fas fa-sync"></i> Load Demo Books
                    </button>
                    <button class="add-btn manual-refresh-btn" onclick="manualRefreshBookData()" style="background: #10b981;">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
            </div>

            <!-- Book Statistics Bar -->
            <div class="book-stats-bar">
                <div class="stat-item">
                    <i class="fas fa-books"></i>
                    <span>Total Books: <strong id="total-books-count">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-check-circle"></i>
                    <span>In Stock: <strong id="in-stock-count">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Low Stock: <strong id="low-stock-count">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-times-circle"></i>
                    <span>Out of Stock: <strong id="out-of-stock-count">0</strong></span>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="book-filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label><i class="fas fa-search"></i> Search</label>
                        <input type="text" id="book-search" placeholder="Search by title, author, ISBN...">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-box"></i> Status</label>
                        <select id="books-status-filter">
                            <option value="">All Status</option>
                            <option value="IN_STOCK">In Stock</option>
                            <option value="LOW_STOCK">Low Stock</option>
                            <option value="OUT_OF_STOCK">Out of Stock</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-sort"></i> Sort By</label>
                        <select id="sort-filter">
                            <option value="title">Title</option>
                            <option value="author">Author</option>
                            <option value="price">Price</option>
                            <option value="rating">Rating</option>
                            <option value="createdAt">Newest</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label><i class="fas fa-rupee-sign"></i> Price Range</label>
                        <div class="price-range">
                            <input type="number" id="min-price" placeholder="Min" min="0">
                            <span>-</span>
                            <input type="number" id="max-price" placeholder="Max" min="0">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-eye"></i> View</label>
                        <select id="view-filter">
                            <option value="grid">Grid View</option>
                            <option value="list">List View</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="filter-btn" onclick="applyBookFilters()">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                        <button class="clear-filter-btn" onclick="clearBookFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Books Grid/List -->
            <div class="books-container">
                <div class="books-grid" id="books-grid">
                    <!-- Books will be loaded here -->
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="book-pagination">
                <!-- Pagination will be generated here -->
            </div>
        </section>

        <!-- Billing Section -->
        <section id="billing-section" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-file-invoice-dollar"></i> Billing System</h1>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="backend-status" id="backend-status">
                        <span class="status-indicator" id="status-indicator">
                            <i class="fas fa-circle"></i>
                        </span>
                        <span id="status-text">Checking backend...</span>
                    </div>
                    <button class="refresh-btn" onclick="refreshBillingData()" title="Refresh billing data">
                        <i class="fas fa-sync-alt"></i> Refresh Bills
                    </button>
                    <button class="test-pdf-btn" onclick="testPDFGeneration()" title="Test PDF generation" style="background: #10b981; margin-left: 10px;">
                        <i class="fas fa-file-pdf"></i> Test PDF
                    </button>
            
                  
            
                  
                  
                </div>
            </div>

            <div class="billing-container">
                <!-- Generate Bill Form -->
                <div class="billing-form">
                    <h3><i class="fas fa-calculator"></i> Generate Bill</h3>
                    <form id="billing-form">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h4><i class="fas fa-user"></i> Customer Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-id-card"></i> Account Number</label>
                                    <input type="text" id="customer-account" placeholder="Enter account number" required>
                                    <button type="button" class="fetch-btn" onclick="fetchCustomer()">
                                        <i class="fas fa-search"></i> Fetch
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> Customer Name</label>
                                    <input type="text" id="customer-name" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Book Selection -->
                        <div class="form-section">
                            <h4><i class="fas fa-book"></i> Book Selection</h4>
                            <div class="book-selector">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label><i class="fas fa-book"></i> Select Book</label>
                                        <select id="book-select" onchange="updateBookPrice()">
                                            <option value="">Choose a book...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-hashtag"></i> Quantity</label>
                                        <input type="number" id="book-quantity" min="1" value="1" onchange="updateBookSubtotal()">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-rupee-sign"></i> Price per Unit</label>
                                        <input type="number" id="book-price" step="0.01" readonly>
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="add-book-btn" onclick="addBookToBill()">
                                            <i class="fas fa-plus"></i> Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Book Items Table -->
                            <div class="bill-items-table">
                                <table id="bill-items">
                                    <thead>
                                        <tr>
                                            <th>Book Title</th>
                                            <th>Quantity</th>
                                            <th>Price/Unit</th>
                                            <th>Subtotal</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bill-items-body">
                                        <!-- Items will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Discounts & Taxes -->
                        <div class="form-section">
                            <h4><i class="fas fa-percentage"></i> Discounts & Taxes</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-tag"></i> Discount Type</label>
                                    <select id="discount-type" onchange="updateDiscount()">
                                        <option value="none">No Discount</option>
                                        <option value="percentage">Percentage (%)</option>
                                        <option value="amount">Fixed Amount (Rs.)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-tag"></i> Discount Value</label>
                                    <input type="number" id="discount-value" step="0.01" min="0" onchange="updateDiscount()">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-receipt"></i> Tax Type</label>
                                    <select id="tax-type" onchange="updateTax()">
                                        <option value="none">No Tax</option>
                                        <option value="vat">VAT (15%)</option>
                                        <option value="nbt">NBT (2%)</option>
                                        <option value="both">VAT + NBT</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Information -->
                        <div class="form-section">
                            <h4><i class="fas fa-credit-card"></i> Payment Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-credit-card"></i> Payment Method</label>
                                    <select id="payment-method" required>
                                        <option value="">Select payment method...</option>
                                        <option value="cash">Cash</option>
                                        <option value="card">Card</option>
                                        <option value="upi">UPI</option>
                                        <option value="bank-transfer">Bank Transfer</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-receipt"></i> Transaction ID</label>
                                    <input type="text" id="transaction-id" placeholder="Optional">
                                </div>
                            </div>
                        </div>

                        <!-- Admin Notes -->
                        <div class="form-section">
                            <h4><i class="fas fa-sticky-note"></i> Admin Notes</h4>
                            <div class="form-group">
                                <textarea id="admin-notes" placeholder="Add internal notes or remarks..."></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="generate-bill-btn">
                                <i class="fas fa-calculator"></i> Generate Bill
                            </button>
                            <button type="button" class="clear-form-btn" onclick="clearBillingFormFields()">
                                <i class="fas fa-eraser"></i> Clear Fields
                            </button>
                            <button type="button" class="clear-preview-btn" onclick="clearBillPreview()" title="Clear bill preview">
                                <i class="fas fa-eye-slash"></i> Clear Preview
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Bill Preview -->
                <div class="bill-preview" id="bill-preview">
                    <!-- Bill preview will be shown here -->
                </div>
            </div>

            <!-- Bill History -->
            <div class="bill-history-section">
                <div class="section-header">
                    <h3><i class="fas fa-history"></i> Recent Bills</h3>
                    <div class="history-filters">
                        <div class="search-group">
                            <i class="fas fa-search"></i>
                            <input type="text" id="history-search" placeholder="Search by account number, name, or bill number...">
                        </div>
                        <div class="date-group">
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="history-date" onchange="filterBillHistory()">
                        </div>
                        <button class="filter-btn" onclick="filterBillHistory()">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                        <button class="clear-filter-btn" onclick="clearBillHistoryFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                        <button class="demo-bills-btn" onclick="loadDemoBills()" title="Load demo bills for testing">
                            <i class="fas fa-database"></i> Demo Bills
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Bill History Table -->
                <div class="bill-history-table">
                    <table id="bill-history">
                        <thead>
                            <tr>
                                <th><i class="fas fa-hashtag"></i> Bill Number</th>
                                <th><i class="fas fa-user-circle"></i> Customer</th>
                                <th><i class="fas fa-calendar-alt"></i> Date</th>
                                <th><i class="fas fa-rupee-sign"></i> Total Amount</th>
                                <th><i class="fas fa-info-circle"></i> Status</th>
                                <th><i class="fas fa-credit-card"></i> Payment Method</th>
                                <th style="text-align: center;"><i class="fas fa-cogs"></i> Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bill-history-body">
                            <!-- Bill history will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- No Bills Message -->
                <div id="no-bills-message" class="no-bills-message" style="display: none;">
                    <div class="no-bills-icon">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <h3>No Bills Found</h3>
                    <p>There are no bills to display. Generate your first bill to get started!</p>
                    <button class="generate-first-bill-btn" onclick="showSection('billing')">
                        <i class="fas fa-plus"></i> Generate First Bill
                    </button>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports-section" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-chart-bar"></i> Reports & Analytics</h1>
                <div class="report-controls">
                    <div class="date-range-picker">
                        <label><i class="fas fa-calendar"></i> Date Range</label>
                        <input type="date" id="report-start-date" onchange="updateReports()">
                        <span>to</span>
                        <input type="date" id="report-end-date" onchange="updateReports()">
                    </div>
                    <div class="export-buttons">
                        <button class="export-btn" onclick="exportReport('pdf')">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                        <button class="export-btn" onclick="printReport()">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                </div>
            </div>

            <!-- Real Data Stats Cards -->
            <div class="quick-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon revenue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-revenue-stat">Rs. 0</h3>
                        <p>Total Revenue</p>
                        <span class="stat-change" id="revenue-change">Loading...</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orders">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-orders-stat">0</h3>
                        <p>Total Orders</p>
                        <span class="stat-change" id="orders-change">Loading...</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon customers">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-customers-stat">0</h3>
                        <p>Total Customers</p>
                        <span class="stat-change" id="customers-change">Loading...</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon books">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-books-stat">0</h3>
                        <p>Total Books</p>
                        <span class="stat-change" id="books-change">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Real Data Analytics -->
            <div class="analytics-grid">
                <!-- Top Selling Books (Real Data) -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-trophy"></i> Top Selling Books</h3>
                        <button class="view-all-btn" onclick="showAllTopBooks()">View All</button>
                    </div>
                    <div class="card-content">
                        <div id="top-books-list" class="top-books-list">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading top books...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock Status Overview (Real Data) -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-warehouse"></i> Stock Status Overview</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="stock-status-chart" height="260"></canvas>
                    </div>
                </div>

                <!-- Category Performance -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-sitemap"></i> Category Performance</h3>
                    </div>
                    <div class="card-content" data-canvas="category-chart">
                        <canvas id="category-chart" height="260"></canvas>
                    </div>
                </div>

                <!-- Revenue by Payment Method -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-money-bill-wave"></i> Revenue by Payment Method</h3>
                    </div>
                    <div class="card-content" data-canvas="revenue-chart">
                        <canvas id="revenue-chart" height="260"></canvas>
                    </div>
                </div>

                <!-- Recent Bills (Real Data) -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Recent Bills</h3>
                        <button class="view-all-btn" onclick="showSection('billing')">View All</button>
                    </div>
                    <div class="card-content">
                        <div id="recent-bills-list" class="activity-list">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading recent bills...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sales Trend (Last 30 Days) -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Sales Trend (30 Days)</h3>
                    </div>
                    <div class="card-content" data-canvas="sales-trend-chart">
                        <canvas id="sales-trend-chart" height="260"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Reports Table -->
            <div class="detailed-reports">
                <div class="section-header">
                    <h3><i class="fas fa-table"></i> Detailed Reports</h3>
                    <div class="table-controls">
                        <select id="report-type" onchange="loadDetailedReport()">
                            <option value="bills">Billing Report</option>
                            <option value="books">Book Performance</option>
                            <option value="customers">Customer Report</option>
                        </select>
                        <button class="export-btn" onclick="exportDetailedReport()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="detailed-reports-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Bill Number</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total Amount</th>
                                <th>Payment Method</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="detailed-reports-body">
                            <tr>
                                <td colspan="7" style="text-align: center; color: #64748b; padding: 2rem;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                    <p>Loading detailed reports...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="add-customer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Customer</h3>
                <button class="close-btn" onclick="closeModal('add-customer-modal')">&times;</button>
            </div>
            <form id="add-customer-form">
                <div class="form-group">
                    <label>Account Number</label>
                    <input type="text" id="new-customer-account" required>
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="new-customer-name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="new-customer-email" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="new-customer-phone" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal('add-customer-modal')">Cancel</button>
                    <button type="submit">Add Customer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-book-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Add New Book</h3>
                <button class="close-btn" onclick="closeModal('add-book-modal')">&times;</button>
            </div>
            <form id="add-book-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="new-book-title" required>
                    </div>
                    <div class="form-group">
                        <label>Author *</label>
                        <input type="text" id="new-book-author" required>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="new-book-category" required>
                            <option value="">Select Category</option>
                            <option value="Featured">Featured</option>
                            <option value="New Arrivals">New Arrivals</option>
                            <option value="Children">Children</option>
                            <option value="Novels">Novels</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Format *</label>
                        <select id="new-book-format" required>
                            <option value="">Select Format</option>
                            <option value="Paperback">Paperback</option>
                            <option value="Hardcover">Hardcover</option>
                            <option value="Digital">Digital</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Price (Rs.) *</label>
                        <input type="number" id="new-book-price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Stock Quantity *</label>
                        <input type="number" id="new-book-stock" min="0" value="10" required>
                    </div>
                    <div class="form-group">
                        <label>ISBN</label>
                        <input type="text" id="new-book-isbn" placeholder="978-XXXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label>Language</label>
                        <input type="text" id="new-book-language" value="English">
                    </div>
                    <div class="form-group">
                        <label>Published Year</label>
                        <input type="number" id="new-book-year" min="1900" max="2030" value="2024">
                    </div>
                    <div class="form-group">
                        <label>Pages</label>
                        <input type="number" id="new-book-pages" min="1" value="200">
                    </div>
                    <div class="form-group">
                        <label>Publisher</label>
                        <input type="text" id="new-book-publisher" value="Pahana Books">
                    </div>
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="url" id="new-book-image" placeholder="https://example.com/image.jpg">
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Description</label>
                    <textarea id="new-book-description" rows="4" placeholder="Enter book description..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal('add-book-modal')">Cancel</button>
                    <button type="submit">Add Book</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div id="edit-book-modal" class="modal" style="display: none;">
        <div class="modal-content modern-modal" style="max-width: 900px;">
            <div class="modal-header modern-header">
                <div class="header-content">
                    <div class="header-icon"><i class="fas fa-edit"></i></div>
                    <div class="header-text">
                        <h3>Edit Book</h3>
                        <p>Update book details and inventory</p>
                    </div>
                </div>
                <button class="close-btn enhanced-close" onclick="closeModal('edit-book-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modern-body">
                <form id="edit-book-form" class="modern-form">
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-book"></i>
                            <h4>Basic Details</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group modern-group">
                                <label class="modern-label">Title *</label>
                                <input class="modern-input" type="text" id="edit-book-title" required>
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Author *</label>
                                <input class="modern-input" type="text" id="edit-book-author" required>
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Category *</label>
                                <select class="modern-input" id="edit-book-category" required>
                                    <option value="">Select Category</option>
                                    <option value="Featured">Featured</option>
                                    <option value="New Arrivals">New Arrivals</option>
                                    <option value="Children">Children</option>
                                    <option value="Novels">Novels</option>
                                </select>
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Format *</label>
                                <select class="modern-input" id="edit-book-format" required>
                                    <option value="">Select Format</option>
                                    <option value="Paperback">Paperback</option>
                                    <option value="Hardcover">Hardcover</option>
                                    <option value="Digital">Digital</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-tags"></i>
                            <h4>Pricing & Inventory</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group modern-group">
                                <label class="modern-label">Price (Rs.) *</label>
                                <input class="modern-input" type="number" id="edit-book-price" step="0.01" required>
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Stock Quantity *</label>
                                <input class="modern-input" type="number" id="edit-book-stock" min="0" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-info-circle"></i>
                            <h4>Additional Information</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group modern-group">
                                <label class="modern-label">ISBN</label>
                                <input class="modern-input" type="text" id="edit-book-isbn" placeholder="978-XXXXXXXXXX">
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Language</label>
                                <input class="modern-input" type="text" id="edit-book-language" value="English">
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Published Year</label>
                                <input class="modern-input" type="number" id="edit-book-year" min="1900" max="2030">
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Pages</label>
                                <input class="modern-input" type="number" id="edit-book-pages" min="1">
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Publisher</label>
                                <input class="modern-input" type="text" id="edit-book-publisher">
                            </div>
                            <div class="form-group modern-group">
                                <label class="modern-label">Image URL</label>
                                <input class="modern-input" type="url" id="edit-book-image" placeholder="https://example.com/image.jpg">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-align-left"></i>
                            <h4>Description</h4>
                        </div>
                        <div class="form-group modern-group">
                            <textarea class="modern-input" id="edit-book-description" rows="4" placeholder="Enter book description..."></textarea>
                        </div>
                    </div>

                    <div class="modern-footer" style="justify-content:flex-end;">
                        <button type="button" class="cancel-btn enhanced" onclick="closeModal('edit-book-modal')">
                            <i class="fas fa-times"></i>
                            <span>Cancel</span>
                        </button>
                        <button type="submit" class="update-btn enhanced">
                            <i class="fas fa-save"></i>
                            <span>Save Changes</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Update Stock Modal -->
    <div id="update-stock-modal" class="modal" style="display: none;">
        <div class="modal-content stock-modal-enhanced">
            <div class="modal-header enhanced-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="header-text">
                        <h3>Update Stock</h3>
                        <p>Manage book inventory and stock levels</p>
                    </div>
                </div>
                <button class="close-btn enhanced-close" onclick="closeModal('update-stock-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body enhanced-body">
                <!-- Book Information Section -->
                <div class="book-info-section enhanced">
                    <div class="book-image-container">
                        <div class="book-image-wrapper">
                            <img id="stock-book-image" src="" alt="Book Cover">
                            <div class="book-overlay">
                                <div class="book-status-badge" id="stock-book-status-badge">
                                    <i class="fas fa-circle"></i>
                                    <span>IN STOCK</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="book-details enhanced">
                        <div class="book-title-section">
                            <h4 id="stock-book-title">Book Title</h4>
                            <div class="book-author-badge">
                                <i class="fas fa-user-edit"></i>
                                <span id="stock-book-author">Author Name</span>
                            </div>
                        </div>
                        
                        <div class="book-meta-grid">
                            <div class="meta-item price-item">
                                <div class="meta-icon">
                                    <i class="fas fa-tag"></i>
                                </div>
                                <div class="meta-content">
                                    <label>Price</label>
                                    <span id="stock-book-price">Rs. 0</span>
                                </div>
                            </div>
                            
                            <div class="meta-item rating-item">
                                <div class="meta-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="meta-content">
                                    <label>Rating</label>
                                    <span id="stock-book-rating">0/5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Current Stock Information Section -->
                <div class="current-stock-info enhanced">
                    <div class="stock-info-header">
                        <div class="info-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="info-content">
                            <h5>Current Stock Information</h5>
                            <p>Real-time inventory status</p>
                        </div>
                    </div>
                    
                    <div class="stock-stats-grid">
                        <div class="stock-stat-item">
                            <div class="stat-icon quantity-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-content">
                                <label>Current Quantity</label>
                                <span id="stock-current-quantity">0</span>
                                <small>units</small>
                            </div>
                        </div>
                        
                        <div class="stock-stat-item">
                            <div class="stat-icon status-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <label>Current Status</label>
                                <span id="stock-current-status" class="status-badge">IN STOCK</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Update Stock Form Section -->
                <form id="update-stock-form" class="enhanced-form" onsubmit="handleUpdateStockSubmit(event)">
                    <div class="form-section enhanced">
                        <div class="section-header">
                            <div class="header-icon">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="header-text">
                                <h4>Update Stock</h4>
                                <p>Modify inventory levels and status</p>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group enhanced">
                                <label for="new-stock-quantity">
                                    <i class="fas fa-hashtag"></i>
                                    NEW STOCK QUANTITY
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="new-stock-quantity" min="0" required placeholder="Enter new quantity">
                                    <div class="input-icon">
                                        <i class="fas fa-boxes"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group enhanced">
                                <label for="stock-update-status">
                                    <i class="fas fa-toggle-on"></i>
                                    STOCK STATUS
                                </label>
                                <div class="select-wrapper">
                                    <select id="stock-update-status" required>
                                        <option value="">Select Status</option>
                                        <option value="IN_STOCK">In Stock</option>
                                        <option value="LOW_STOCK">Low Stock</option>
                                        <option value="OUT_OF_STOCK">Out of Stock</option>
                                    </select>
                                    <div class="select-icon">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="form-actions enhanced">
                            <button type="button" class="cancel-btn enhanced" onclick="closeModal('update-stock-modal')">
                                <i class="fas fa-times"></i>
                                <span>X CANCEL</span>
                            </button>

                            <button type="submit" class="update-btn enhanced">
                                <i class="fas fa-sync-alt"></i>
                                <span>UPDATE STOCK</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="admin-dashboard.js"></script>
    <script src="admin-dashboard-enhanced-reports.js"></script>
</body>
</html> 